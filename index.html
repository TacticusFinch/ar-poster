<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Magic Chess Poster</title>

  <!-- MindAR + A-Frame CDN -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body, html{margin:0;height:100%;overflow:hidden;background:#000;}
    #ar-scene{width:100%;height:100%;}
  </style>
</head>
<body>
  <!-- Контейнер AR-сцены -->
  <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: true;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      renderer="colorManagement: true, physicallyCorrectLights"
      id="ar-scene">

    <!-- Камера MindAR -->
    <a-camera position="0 0 0" look-controls="enabled: false"
              raycaster="objects: .clickable"
              cursor="fuse: false; rayOrigin: mouse">
    </a-camera>

    <!-- Anchor, привязанный к постеру -->
    <a-entity mindar-image-target="targetIndex: 0">

      <!-- Видео волшебника (появляется сразу после нахождения постера) -->
      <a-video id="wizVideo"
               src="#wiz"
               width="1" height="0.56"     <!-- пропорции 16:9 -->
               position="0 0 0"
               rotation="0 0 0"
               autoplay="false" loop="false"
               preload="auto">
      </a-video>

      <!-- Кнопка "Играть" -->
      <a-plane id="playBtn" class="clickable"
               visible="false"
               width="0.5" height="0.18"
               position="0 -0.4 0.01"
               material="color: #00c853; opacity:0.8"
               animation__pulse="property: scale; dir:alternate; dur:800; loop:true; to:1.2 1.2 1">
        <a-text value="Играть"
                align="center" color="#fff" width="2"
                position="0 0 0.01"></a-text>
      </a-plane>

      <!-- Кнопка "Записаться" -->
      <a-plane id="signupBtn" class="clickable"
               visible="false"
               width="0.5" height="0.18"
               position="0 -0.65 0.01"
               material="color: #2962ff; opacity:0.8"
               animation__pulse="property: scale; dir:alternate; dur:800; loop:true; to:1.2 1.2 1">
        <a-text value="Записаться"
                align="center" color="#fff" width="2"
                position="0 0 0.01"></a-text>
      </a-plane>

    </a-entity>

    <!-- Реальный источник видео (скрытый) -->
    <video id="wiz" src="./wizard.mp4" preload="auto" playsinline webkit-playsinline></video>
  </a-scene>

  <script>
    // Получаем элементы
    const sceneEl = document.querySelector('a-scene');
    const videoEl = document.getElementById('wiz');
    const videoPlane = document.getElementById('wizVideo');
    const playBtn   = document.getElementById('playBtn');
    const signupBtn = document.getElementById('signupBtn');

    // Старт видео, когда найден таргет
    sceneEl.addEventListener("targetFound", () => {
      if (videoEl.paused) {
        videoEl.play().catch(()=>{});   // iOS требует жест
      }
    });

    // После окончания видео показываем кнопки
    videoEl.addEventListener('ended', () => {
      playBtn.setAttribute('visible', true);
      signupBtn.setAttribute('visible', true);
    });

    // Навигация при клике
    playBtn.addEventListener('click', () => {
      window.location.href = "https://lichess.org/ru/learn";
    });

    signupBtn.addEventListener('click', () => {
      window.location.href = "https://t.me/m/s_Zqu21RY2Yy";
    });
  </script>
</body>
</html>