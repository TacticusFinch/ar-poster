<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Magic Chess Poster</title>

<meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no,viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>

<style>
html,body{margin:0;padding:0;width:100%;height:100%;}
#app,a-scene{width:100%;height:100%;}

/* --- NEW ------------------------------------------------------------------ */
/* заставляем видео-поток MindAR растягиваться на весь экран без «рамок» */
#mindar-image-video{
  position:fixed !important;           /* поверх всего, под 3D-слоем */
  top:0;left:0;width:100vw;height:100vh;
  object-fit:cover;                    /* заполняем экран, без чёрных полос */
  z-index:-2;                          /* под канvas-ом A-Frame */
}

/* сам канvas с 3D сценой тоже на весь экран */
a-scene canvas{
  position:fixed !important;
  top:0;left:0;width:100vw !important;height:100vh !important;
}
/* -------------------------------------------------------------------------- */

#buttons{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%) translateY(100px); /* +100 px вниз */
  display:flex;flex-direction:column;gap:22px;align-items:center;
  pointer-events:none;opacity:0;transition:opacity .5s;
}
#buttons.show{opacity:1;pointer-events:auto;}

#buttons a{
  font:700 2rem/1 "Trebuchet MS",sans-serif;
  color:#fff;text-decoration:none;
  padding:18px 64px;border-radius:14px;
  background:linear-gradient(135deg,#ff512f 0%,#dd2476 100%);
  box-shadow:0 0 18px rgba(255,255,255,.7);
  transition:transform .15s,box-shadow .15s;
}
#buttons a:hover{transform:scale(1.05);box-shadow:0 0 30px rgba(255,255,255,1);}
</style>
</head>

<body>
<div id="app">

  <a-scene
    mindar-image="imageTargetSrc: targets.mind; uiScanning: false; uiLoading: false;"
    color-space="sRGB" embedded
    renderer="colorManagement:true,physicallyCorrectLights"
    vr-mode-ui="enabled:false"
    device-orientation-permission-ui="enabled:false">

    <a-assets>
      <video id="wizard" src="wizard.mp4" preload="auto" crossorigin="anonymous"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

    <a-entity mindar-image-target="targetIndex:0">
      <a-video src="#wizard" width="1" height="0.5625" position="0 0 0"
               autoplay="false" loop="false"></a-video>
    </a-entity>
  </a-scene>

  <div id="buttons">
    <a id="play" href="https://lichess.org/ru/learn" target="_blank" rel="noopener">Играть</a>
    <a id="sign" href="https://t.me/m/s_Zqu21RY2Yy" target="_blank" rel="noopener">Записаться</a>
  </div>

</div>

<script>
/* JS */
document.addEventListener("DOMContentLoaded", () => {

  const scene  = document.querySelector("a-scene");
  const video  = document.querySelector("#wizard");
  const anchor = document.querySelector("[mindar-image-target]");
  const ui     = document.querySelector("#buttons");
  const plane  = anchor.querySelector("a-video");   // плоскость-носитель

  /* ждём метаданные, чтобы узнать точные размеры ролика */
  video.addEventListener("loadedmetadata", () => {
    const ratio = video.videoHeight / video.videoWidth; // h/w

    /*  Ширина маркера у MindAR = 1 (единица мира).
        Подгоняем высоту плоскости под ролик динамически,
        чтобы заполнять маркер без искажений.               */
    plane.setAttribute("width", 1);
    plane.setAttribute("height", ratio);
  });

  /* заставляем камеру-стрим «без рамок» */
  scene.addEventListener("renderstart", () => {
    const camVideo = document.querySelector("#mindar-image-video");
    if (camVideo) camVideo.style.objectFit = "cover";
  });

  anchor.addEventListener("targetFound", () => setTimeout(()=>video.play(), 500));
  video.addEventListener("ended", () => ui.classList.add("show"));
});

</script>
</body>
</html>
